{"version":3,"file":"analytic_events.min.js","sources":["../src/analytic_events.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module analytic_events\n *\n * @module     tiny_cursive/analytic_events\n * @copyright  2024 CTI <your@email.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport myModal from \"./analytic_modal\";\nimport {call as getContent} from \"core/ajax\";\nimport $ from 'jquery';\nimport * as Str from 'core/str';\nimport Chart from 'core/chartjs';\nexport default class AnalyticEvents {\n\n    createModal(userid, context, questionid = '', authIcon) {\n        $('#analytics' + userid + questionid).on('click', function(e) {\n            e.preventDefault();\n\n            // Create Moodle modal\n            myModal.create({templateContext: context}).then(modal => {\n                $('#content' + userid + ' .table tbody tr:first-child td:nth-child(2)').html(authIcon);\n                modal.show();\n                return true;\n            }).catch(error => {\n                window.window.console.error(\"Failed to create modal:\", error);\n            });\n        });\n    }\n\n    analytics(userid, templates, context, questionid = '', replayInstances = null, authIcon) {\n        $('body').on('click', '#analytic' + userid + questionid, function(e) {\n            $('#rep' + userid + questionid).prop('disabled', false);\n            $('#quality' + userid + questionid).prop('disabled', false);\n            e.preventDefault();\n            $('#content' + userid).html($('<div>').addClass('d-flex justify-content-center my-5')\n                .append($('<div>').addClass('tiny_cursive-loader')));\n            if (replayInstances && replayInstances[userid]) {\n                replayInstances[userid].stopReplay();\n            }\n            $('.tiny_cursive-nav-tab').find('.active').removeClass('active');\n            $(this).addClass('active'); // Add 'active' class to the clicked element\n\n            templates.render('tiny_cursive/analytics_table', context).then(function(html) {\n                $('#content' + userid).html(html);\n                $('#content' + userid + ' .table tbody tr:first-child td:nth-child(2)').html(authIcon);\n                return true;\n            }).fail(function(error) {\n                window.console.error(\"Failed to render template:\", error);\n            });\n        });\n    }\n\n    checkDiff(userid, fileid, questionid = '', replayInstances = null) {\n        const nodata = document.createElement('p');\n        nodata.classList.add('text-center', 'p-5', 'bg-light', 'rounded', 'm-5', 'text-primary');\n        nodata.style.verticalAlign = 'middle';\n        nodata.style.textTransform = 'uppercase';\n        nodata.style.fontWeight = '500';\n        nodata.textContent = \"no data received yet\";\n\n        $('body').on('click', '#diff' + userid + questionid, function(e) {\n            $('#rep' + userid + questionid).prop('disabled', false);\n            $('#quality' + userid + questionid).prop('disabled', false);\n            e.preventDefault();\n            $('#content' + userid).html($('<div>').addClass('d-flex justify-content-center my-5')\n                .append($('<div>').addClass('tiny_cursive-loader')));\n            $('.tiny_cursive-nav-tab').find('.active').removeClass('active');\n            $(this).addClass('active');\n            if (replayInstances && replayInstances[userid]) {\n                replayInstances[userid].stopReplay();\n            }\n            if (!fileid) {\n                $('#content' + userid).html(nodata);\n                throw new Error('Missing file id or Difference Content not received yet');\n            }\n            getContent([{\n                methodname: 'cursive_get_writing_differences',\n                args: {fileid: fileid},\n            }])[0].done(response => {\n                let responsedata = JSON.parse(response.data);\n                if (responsedata[0]) {\n                    let submittedText = atob(responsedata[0].submitted_text);\n\n                    // Fetch the dynamic strings\n                    Str.get_strings([\n                        {key: 'original_text', component: 'tiny_cursive'},\n                        {key: 'editspastesai', component: 'tiny_cursive'}\n                    ]).done(strings => {\n                        const originalTextString = strings[0];\n                        const editsPastesAIString = strings[1];\n\n                        const $legend = $('<div class=\"d-flex p-2 border rounded mb-2\">');\n\n                        // Create the first legend item\n                        const $attributedItem = $('<div>', {\"class\": \"tiny_cursive-legend-item\"});\n                        const $attributedBox = $('<div>', {\"class\": \"tiny_cursive-box attributed\"});\n                        const $attributedText = $('<span>').text(originalTextString);\n                        $attributedItem.append($attributedBox).append($attributedText);\n\n                        // Create the second legend item\n                        const $unattributedItem = $('<div>', {\"class\": 'tiny_cursive-legend-item'});\n                        const $unattributedBox = $('<div>', {\"class\": 'tiny_cursive-box tiny_cursive_added'});\n                        const $unattributedText = $('<span>').text(editsPastesAIString);\n                        $unattributedItem.append($unattributedBox).append($unattributedText);\n\n                        // Append the legend items to the legend container.\n                        $legend.append($attributedItem).append($unattributedItem);\n\n                        let contents = $('<div>').addClass('tiny_cursive-comparison-content');\n                        let textBlock2 = $('<div>').addClass('tiny_cursive-text-block').append(\n                            $('<div>').attr('id', 'tiny_cursive-reconstructed_text').html(JSON.parse(submittedText))\n                        );\n\n                        contents.append($legend, textBlock2);\n                        $('#content' + userid).html(contents); // Update content\n                    }).fail(error => {\n                        window.console.error(\"Failed to load language strings:\", error);\n                        $('#content' + userid).html(nodata);\n                    });\n                } else {\n                    $('#content' + userid).html(nodata);\n                }\n            }).fail(error => {\n                $('#content' + userid).html(nodata);\n                throw new Error('Error loading JSON file: ' + error.message);\n            });\n        });\n    }\n\n    replyWriting(userid, filepath, questionid = '', replayInstances = null) {\n        $('body').on('click', '#rep' + userid + questionid, function(e) {\n            $(this).prop('disabled', true);\n            $('#quality' + userid + questionid).prop('disabled', false);\n            e.preventDefault();\n            $('#content' + userid).html($('<div>').addClass('d-flex justify-content-center my-5')\n                .append($('<div>').addClass('tiny_cursive-loader')));\n            $('.tiny_cursive-nav-tab').find('.active').removeClass('active');\n            $(this).addClass('active'); // Add 'active' class to the clicked element\n            if (replayInstances && replayInstances[userid]) {\n                replayInstances[userid].stopReplay();\n            }\n            if (questionid) {\n                // eslint-disable-next-line\n                video_playback(userid, filepath, questionid);\n            } else {\n                // eslint-disable-next-line\n                video_playback(userid, filepath);\n            }\n        });\n    }\n\n    quality(userid, templates, context, questionid = '', replayInstances = null, cmid) {\n        let metricsData = '';\n        const nodata = document.createElement('p');\n        nodata.classList.add('text-center', 'p-5', 'bg-light', 'rounded', 'm-5', 'text-primary');\n        nodata.style.verticalAlign = 'middle';\n        nodata.style.textTransform = 'uppercase';\n        nodata.style.fontWeight = '500';\n        nodata.textContent = \"no data received yet\";\n\n        $('body').on('click', '#quality' + userid + questionid, function(e) {\n\n            $(this).prop('disabled', true);\n            $('#rep' + userid + questionid).prop('disabled', false);\n            e.preventDefault();\n            $('.tiny_cursive-nav-tab').find('.active').removeClass('active');\n            $(this).addClass('active'); // Add 'active' class to the clicked element\n\n            let res = getContent([{\n                methodname: 'cursive_get_quality_metrics',\n                args: {\"file_id\": context.tabledata.file_id ?? userid, cmid: cmid},\n            }]);\n\n            const content = document.getElementById('content' + userid);\n            if (content) {\n                content.innerHTML = '';\n                const loaderDiv = document.createElement('div');\n                loaderDiv.className = 'd-flex justify-content-center my-5';\n                const loader = document.createElement('div');\n                loader.className = 'tiny_cursive-loader';\n                loaderDiv.appendChild(loader);\n                content.appendChild(loaderDiv);\n            }\n\n            if (replayInstances && replayInstances[userid]) {\n                replayInstances[userid].stopReplay();\n            }\n\n            templates.render('tiny_cursive/quality_chart', context).then(function(html) {\n                const content = document.getElementById('content' + userid);\n\n                res[0].done(response => {\n                    if (response.status) {\n                        metricsData = response.data;\n                        let proUser = metricsData.quality_access;\n\n                        if (!proUser) {\n                            // eslint-disable-next-line promise/no-nesting\n                            templates.render('tiny_cursive/upgrade_to_pro', []).then(function(html) {\n                                $('#content' + userid).html(html);\n                                return true;\n                                }).fail(function(error) {\n                                window.console.error(error);\n                            });\n                        } else {\n\n                            if (content) {\n                                content.innerHTML = html;\n                            }\n                            if (!metricsData) {\n                                $('#content' + userid).html(nodata);\n                            }\n\n                            var originalData = [\n                                metricsData.word_len_mean, metricsData.edits, metricsData.p_burst_cnt, metricsData.p_burst_mean,\n                                metricsData.q_count, metricsData.sentence_count, metricsData.total_active_time,\n                                metricsData.verbosity, metricsData.word_count, metricsData.sent_word_count_mean\n                            ];\n\n                            let chartvas = document.querySelector('#chart' + userid);\n                            const data = {\n                                labels: [\n                                    'Average Word Length',\n                                    'Edits',\n                                    'P-burst Count',\n                                    'P-Burst Mean',\n                                    'Q Count',\n                                    'Sentence Count',\n                                    'Total Active Time',\n                                    'Verbosity',\n                                    'Word Count',\n                                    'Word Count per Sentence Mean'\n                                ],\n                                datasets: [{\n                                    data: originalData.map(d => {\n                                        if (d > 100) {\n                                            return 100;\n                                        } else if (d < -100) {\n                                            return -100;\n                                        } else {\n                                            return d;\n                                        }\n                                    }),\n                                    backgroundColor: function(context) {\n                                        // Apply green or gray depending on value.\n                                        const value = context.raw;\n\n                                        if (value > 0 && value < 100) {\n                                            return '#43BB97';\n                                        } else if (value < 0) {\n                                            return '#AAAAAA';\n                                        } else {\n                                            return '#00432F'; // Green for positive, gray for negative.\n                                        }\n\n                                    },\n                                    barPercentage: 0.75,\n                                }]\n                            };\n\n                            const drawPercentage = {\n                                id: 'drawPercentage',\n                                afterDraw: (chart) => {\n                                    const {ctx, data} = chart;\n                                    ctx.save();\n                                    let value;\n                                    chart.getDatasetMeta(0).data.forEach((dataPoint, index) => {\n                                        value = parseInt(data.datasets[0].data[index]);\n                                        if (!value) {\n                                            value = 0;\n                                        }\n                                        value = originalData[index];\n\n                                        ctx.font = \"bold 14px sans-serif\";\n\n                                        if (value > 50 && value <= 100) {\n                                            ctx.fillStyle = 'white';\n                                            ctx.textAlign = 'right';\n                                            ctx.fillText(value + '%', dataPoint.x - 5, dataPoint.y + 5);\n                                        } else if (value <= 10 && value > 0) {\n                                            ctx.fillStyle = '#43bb97';\n                                            ctx.textAlign = 'left';\n                                            if (value >= 1) {\n                                                ctx.fillText('0' + value + '%', dataPoint.x + 5, dataPoint.y + 5);\n                                            } else {\n                                                ctx.fillText(value + '%', dataPoint.x + 5, dataPoint.y + 5);\n                                            }\n                                        // eslint-disable-next-line no-empty\n                                        } else if (value == 0 || value == undefined) {\n                                        } else if (value > 100) {\n                                            ctx.fillStyle = 'white';\n                                            ctx.textAlign = 'right';\n                                            ctx.fillText(value + '%', dataPoint.x - 5, dataPoint.y + 5);\n                                        } else if (value < -50 && value >= -100) {\n                                            ctx.fillStyle = 'white';\n                                            ctx.textAlign = 'left';\n                                            ctx.fillText(value + '%', dataPoint.x + 5, dataPoint.y + 5);\n                                        } else if (value < -100) {\n                                            ctx.fillStyle = 'white';\n                                            ctx.textAlign = 'left';\n                                            ctx.fillText(value + '%', dataPoint.x + 5, dataPoint.y + 5);\n                                        } else if (value > -50 && value < 0) {\n                                            ctx.fillStyle = 'grey';\n                                            ctx.textAlign = 'right';\n                                            ctx.fillText(value + '%', dataPoint.x - 5, dataPoint.y + 5);\n                                        } else {\n                                            ctx.fillStyle = '#43bb97';\n                                            ctx.textAlign = 'left';\n                                            ctx.fillText(value + '%', dataPoint.x + 5, dataPoint.y + 5);\n                                        }\n\n                                    });\n                                }\n                            };\n\n                            const chartAreaBg = {\n                                id: 'chartAreaBg',\n                                beforeDraw: (chart) => {\n                                    const {ctx, scales: {x, y}} = chart;\n                                    ctx.save();\n\n                                    const segmentPixel = y.getPixelForValue(y.ticks[0].value) -\n                                        y.getPixelForValue(y.ticks[1].value);\n                                    const doubleSegment = y.ticks[2].value - y.ticks[0].value;\n                                    let tickArray = [];\n\n                                    // Generate tick values.\n                                    for (let i = 0; i <= y.max; i += doubleSegment) {\n                                        if (i !== y.max) {\n                                            tickArray.push(i);\n                                        }\n                                    }\n\n                                    // Draw the background rectangles for each tick.\n                                    tickArray.forEach(tick => {\n                                        ctx.fillStyle = 'rgba(0, 0, 0, 0.02)';\n                                        ctx.fillRect(0, y.getPixelForValue(tick) + 63, x.width + x.width + 21, segmentPixel);\n                                    });\n                                }\n                            };\n\n\n                            new Chart(chartvas, {\n                                type: 'bar',\n                                data: data,\n                                options: {\n                                    responsive: false,\n                                    maintainAspectRatio: false,\n                                    indexAxis: 'y',\n                                    elements: {\n                                        bar: {\n                                            borderRadius: 16,\n                                            borderWidth: 0,\n                                            zIndex: 1,\n                                        }\n                                    },\n                                    scales: {\n                                        x: {\n                                            beginAtZero: true,\n                                            min: -100,\n                                            max: 100,\n                                            ticks: {\n                                                callback: function(value) {\n                                                    if (value === -100 || value === 100) {\n                                                        return value + '%';\n                                                    } else if (value === 0) {\n                                                        return 'Average';\n                                                    }\n                                                    return '';\n                                                },\n                                                display: true,\n                                                font: function(context) {\n                                                    if (context && context.tick && context.tick.value === 0) {\n                                                        return {\n                                                            weight: 'bold',\n                                                            size: 14,\n                                                            color: 'black'\n                                                        };\n                                                    }\n                                                    return {\n                                                        weight: 'bold',\n                                                        size: 13,\n                                                        color: 'black'\n                                                    };\n                                                },\n                                                color: 'black',\n\n                                            },\n                                            grid: {\n                                                display: true,\n                                                color: function(context) {\n                                                    return context.tick.value === 0 ? 'black' : '#eaeaea';\n                                                },\n                                                tickLength: 0,\n                                            },\n                                            position: 'top'\n\n                                        },\n                                        y: {\n                                            beginAtZero: true,\n                                            ticks: {\n                                                display: true,\n                                                align: 'center',\n\n                                                crossAlign: 'far',\n                                                font: {\n                                                    size: 18,\n                                                },\n                                                tickLength: 100,\n                                                color: 'black',\n                                            },\n                                            grid: {\n                                                display: true,\n                                                tickLength: 1000,\n                                            },\n\n                                        }\n                                    },\n                                    plugins: {\n                                        legend: {\n                                            display: false,\n                                        },\n                                        title: {\n                                            display: false,\n                                        },\n                                        tooltip: {\n                                            yAlign: 'bottom',\n                                            xAlign: 'center',\n                                            callbacks: {\n                                                label: function(context) {\n                                                    const originalValue = originalData[context.dataIndex];\n                                                    return originalValue; // Show the original value.\n                                                },\n                                            },\n                                        },\n                                    }\n                                },\n                                plugins: [chartAreaBg, drawPercentage]\n                            });\n                        }\n                    }\n                }).fail(error => {\n                    $('#content' + userid).html(nodata);\n                    throw new Error('Error: no data received yet', error);\n                });\n                return true;\n            }).catch(function(error) {\n                window.console.error(\"Failed to render template:\", error);\n            });\n\n            document.querySelectorAll('.tiny_cursive-nav-tab .active').forEach(el => el.classList.remove('active'));\n            e.target.classList.add('active');\n        });\n    }\n\n    formatedTime(data) {\n        if (data.total_time_seconds) {\n            let totalTimeSeconds = data.total_time_seconds;\n            let hours = Math.floor(totalTimeSeconds / 3600).toString().padStart(2, 0);\n            let minutes = Math.floor((totalTimeSeconds % 3600) / 60).toString().padStart(2, 0);\n            let seconds = (totalTimeSeconds % 60).toString().padStart(2, 0);\n            return `${hours}h ${minutes}m ${seconds}s`;\n        } else {\n            return \"0h 0m 0s\";\n        }\n    }\n\n    authorshipStatus(firstFile, score, scoreSetting) {\n        var icon = 'fa fa-circle-o';\n        var color = 'font-size:32px;color:black';\n            score = parseFloat(score);\n\n        if (firstFile) {\n            icon = 'fa fa-solid fa-info-circle';\n            color = 'font-size:32px;color:#000000';\n        } else if (score >= scoreSetting) {\n            icon = 'fa fa-check-circle';\n            color = 'font-size:32px;color:green';\n        } else if (score < scoreSetting) {\n            icon = 'fa fa-question-circle';\n            color = 'font-size:32px;color:#A9A9A9';\n        }\n\n        return $('<i>').addClass(icon).attr('style', color);\n    }\n}\n"],"names":["_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","_interopRequireDefault","obj","__esModule","default","_analytic_modal","_jquery","Str","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_interopRequireWildcard","_chartjs","_exports","createModal","userid","context","questionid","arguments","length","undefined","authIcon","$","on","e","preventDefault","myModal","create","templateContext","then","modal","html","show","catch","error","window","console","analytics","templates","replayInstances","prop","addClass","append","stopReplay","find","removeClass","this","render","fail","checkDiff","fileid","nodata","document","createElement","classList","add","style","verticalAlign","textTransform","fontWeight","textContent","Error","getContent","methodname","args","done","response","responsedata","JSON","parse","data","submittedText","atob","submitted_text","get_strings","component","strings","originalTextString","editsPastesAIString","$legend","$attributedItem","class","$attributedBox","$attributedText","text","$unattributedItem","$unattributedBox","$unattributedText","contents","textBlock2","attr","message","replyWriting","filepath","video_playback","quality","cmid","metricsData","_context$tabledata$fi","res","file_id","tabledata","content","getElementById","innerHTML","loaderDiv","className","loader","appendChild","status","quality_access","originalData","word_len_mean","edits","p_burst_cnt","p_burst_mean","q_count","sentence_count","total_active_time","verbosity","word_count","sent_word_count_mean","chartvas","querySelector","labels","datasets","map","d","backgroundColor","value","raw","barPercentage","drawPercentage","id","afterDraw","chart","ctx","save","getDatasetMeta","forEach","dataPoint","index","parseInt","font","fillStyle","textAlign","fillText","x","y","chartAreaBg","beforeDraw","scales","segmentPixel","getPixelForValue","ticks","doubleSegment","tickArray","i","max","push","tick","fillRect","width","Chart","type","options","responsive","maintainAspectRatio","indexAxis","elements","bar","borderRadius","borderWidth","zIndex","beginAtZero","min","callback","display","weight","size","color","grid","tickLength","position","align","crossAlign","plugins","legend","title","tooltip","yAlign","xAlign","callbacks","label","dataIndex","querySelectorAll","el","remove","target","formatedTime","total_time_seconds","totalTimeSeconds","hours","Math","floor","toString","padStart","minutes","seconds","concat","authorshipStatus","firstFile","score","scoreSetting","icon","parseFloat"],"mappings":"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"}